# ==========================================
# V4.0 - 全自动化测试脚本 (RBAC & 核心业务)
# ==========================================

### 1. 登录 (获取全局 Token)
# @name login
POST http://localhost:8080/auth/login
Content-Type: application/json

{
  "username": "music_lover_001",
  "password": "123456"
}

> {%
    // 脚本：捕获 Token，存为全局变量 auth_token
    client.global.set("auth_token", response.body.data.token);
    client.log("TOKEN CAPTURED: " + response.body.data.token.substring(0, 30) + "...");
%}


# ==========================================
# 2. 核心业务测试
# ==========================================

### 2.1 创建歌单 (并捕获新生成的 ID)
# @name create_playlist
POST http://localhost:8080/playlist/create
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "title": "自动化测试歌单",
  "description": "由脚本自动创建"
}

> {%
    // 脚本：捕获新创建的歌单 ID，存为全局变量 playlist_id
    client.global.set("playlist_id", response.body.data.id);
    client.log("PLAYLIST ID CAPTURED: " + response.body.data.id);
%}


### 2.2 将歌曲 (ID=1) 收藏到歌单 (使用捕获的 ID)
POST http://localhost:8080/playlist/addSong
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "playlistId": {{playlist_id}},
  "songId": 1
}


### 2.3 记录一次“喜欢”行为 (AI 数据收集)
POST http://localhost:8080/interaction/record
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "songId": 1,
  "type": 3
}


### 2.4 查询歌单列表 (验证创建和收藏成功)
GET http://localhost:8080/playlist/my
Authorization: Bearer {{auth_token}}


# ==========================================
# 3. 搜索功能测试
# ==========================================

### 3.1 测试搜索接口 (模糊查询)
GET http://localhost:8080/search?keyword=音乐
Authorization: Bearer {{auth_token}}


### 3.2 测试推荐接口 (降级模式)
GET http://localhost:8080/recommend/daily
Authorization: Bearer {{auth_token}}